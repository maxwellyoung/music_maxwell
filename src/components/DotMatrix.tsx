"use client";
import React, { useState, useEffect } from "react";
import { motion } from "framer-motion";
import styles from "../styles/DotMatrix.module.css";

// Define the precise pattern for a star shape
const starPattern = [
  515, 516, 517, 518, 519, 534, 535, 536, 537, 538, 550, 551, 552, 553, 554,
  566, 567, 568, 569, 570, 585, 586, 587, 588, 589, 603, 604, 605, 606, 607,
  620, 621, 622, 623, 624, 637, 638, 639, 640, 641, 652, 653, 654, 655, 656,
  668, 669, 670, 671, 672, 683, 684, 685, 686, 687, 699, 700, 701, 702, 703,
  715, 716, 717, 718, 719, 731, 732, 733, 734, 735, 747, 748, 749, 750, 751,
  763, 764, 765, 766, 767, 779, 780, 781, 782, 783, 795, 796, 797, 798, 799,
  811, 812, 813, 814, 815, 827, 828, 829, 830, 831, 843, 844, 845, 846, 847,
  859, 860, 861, 862, 863, 875, 876, 877, 878, 879, 891, 892, 893, 894, 895,
  907, 908, 909, 910, 911, 923, 924, 925, 926, 927, 939, 940, 941, 942, 943,
  955, 956, 957, 958, 959, 971, 972, 973, 974, 975, 987, 988, 989, 990, 991,
  1003, 1004, 1005, 1006, 1007, 1019, 1020, 1021, 1022, 1023, 1035, 1036, 1037,
  1038, 1039, 1051, 1052, 1053, 1054, 1055, 1067, 1068, 1069, 1070, 1071, 1083,
  1084, 1085, 1086, 1087, 1099, 1100, 1101, 1102, 1103, 1115, 1116, 1117, 1118,
  1119, 1131, 1132, 1133, 1134, 1135, 1147, 1148, 1149, 1150, 1151, 1163, 1164,
  1165, 1166, 1167, 1179, 1180, 1181, 1182, 1183, 1195, 1196, 1197, 1198, 1199,
  1211, 1212, 1213, 1214, 1215, 1227, 1228, 1229, 1230, 1231, 1243, 1244, 1245,
  1246, 1247, 1259, 1260, 1261, 1262, 1263, 1275, 1276, 1277, 1278, 1279, 1291,
  1292, 1293, 1294, 1295, 1307, 1308, 1309, 1310, 1311, 1323, 1324, 1325, 1326,
  1327, 1339, 1340, 1341, 1342, 1343, 1355, 1356, 1357, 1358, 1359, 1371, 1372,
  1373, 1374, 1375, 1387, 1388, 1389, 1390, 1391, 1403, 1404, 1405, 1406, 1407,
  1419, 1420, 1421, 1422, 1423, 1435, 1436, 1437, 1438, 1439, 1451, 1452, 1453,
  1454, 1455, 1467, 1468, 1469, 1470, 1471, 1483, 1484, 1485, 1486, 1487, 1499,
  1500, 1501, 1502, 1503, 1515, 1516, 1517, 1518, 1519, 1531, 1532, 1533, 1534,
  1535, 1547, 1548, 1549, 1550, 1551, 1563, 1564, 1565, 1566, 1567, 1579, 1580,
  1581, 1582, 1583, 1595, 1596, 1597, 1598, 1599, 1611, 1612, 1613, 1614, 1615,
  1627, 1628, 1629, 1630, 1631, 1643, 1644, 1645, 1646, 1647, 1659, 1660, 1661,
  1662, 1663, 1675, 1676, 1677, 1678, 1679, 1691, 1692, 1693, 1694, 1695, 1707,
  1708, 1709, 1710, 1711, 1723, 1724, 1725, 1726, 1727, 1739, 1740, 1741, 1742,
  1743, 1755, 1756, 1757, 1758, 1759, 1771, 1772, 1773, 1774, 1775, 1787, 1788,
  1789, 1790, 1791, 1803, 1804, 1805, 1806, 1807, 1819, 1820, 1821, 1822, 1823,
  1835, 1836, 1837, 1838, 1839, 1851, 1852, 1853, 1854, 1855, 1867, 1868, 1869,
  1870, 1871, 1883, 1884, 1885, 1886, 1887, 1899, 1900, 1901, 1902, 1903, 1915,
  1916, 1917, 1918, 1919, 1931, 1932, 1933, 1934, 1935, 1947, 1948, 1949, 1950,
  1951, 1963, 1964, 1965, 1966, 1967, 1979, 1980, 1981, 1982, 1983, 1995, 1996,
  1997, 1998, 1999, 2011, 2012, 2013, 2014, 2015, 2027, 2028, 2029, 2030, 2031,
  2043, 2044, 2045, 2046, 2047, 2059, 2060, 2061, 2062, 2063, 2075, 2076, 2077,
  2078, 2079, 2091, 2092, 2093, 2094, 2095, 2107, 2108, 2109, 2110, 2111, 2123,
  2124, 2125, 2126, 2127, 2139, 2140, 2141, 2142, 2143, 2155, 2156, 2157, 2158,
  2159, 2171, 2172, 2173, 2174, 2175, 2187, 2188, 2189, 2190, 2191, 2203, 2204,
  2205, 2206, 2207, 2219, 2220, 2221, 2222, 2223, 2235, 2236, 2237, 2238, 2239,
  2251, 2252, 2253, 2254, 2255, 2267, 2268, 2269, 2270, 2271, 2283, 2284, 2285,
  2286, 2287, 2299, 2300, 2301, 2302, 2303, 2315, 2316, 2317, 2318, 2319, 2331,
  2332, 2333, 2334, 2335, 2347, 2348, 2349, 2350, 2351, 2363, 2364, 2365, 2366,
  2367, 2379, 2380, 2381, 2382, 2383, 2395, 2396, 2397, 2398, 2399, 2411, 2412,
  2413, 2414, 2415, 2427, 2428, 2429, 2430, 2431, 2443, 2444, 2445, 2446, 2447,
  2459, 2460, 2461, 2462, 2463, 2475, 2476, 2477, 2478, 2479, 2491, 2492, 2493,
  2494, 2495,
];

const DotMatrix: React.FC = () => {
  const [dots, setDots] = useState<boolean[]>(Array(2500).fill(false));
  const [revealed, setRevealed] = useState<boolean>(false);

  useEffect(() => {
    if (revealed) {
      setDots((prevDots) => {
        const newDots = [...prevDots];
        starPattern.forEach((index) => {
          newDots[index] = true;
        });
        return newDots;
      });
    }
  }, [revealed]);

  useEffect(() => {
    const timeout = setTimeout(() => {
      setRevealed(true);
    }, 3000); // 3 seconds delay before revealing the pattern

    return () => clearTimeout(timeout);
  }, []);

  const handleMouseOver = (index: number) => {
    setDots((prevDots) => {
      const newDots = [...prevDots];
      newDots[index] = true;
      return newDots;
    });
  };

  return (
    <div>
      <div className={styles["dot-matrix-container"]}>
        {dots.map((dot, index) => (
          <motion.div
            key={index}
            className={`${styles.dot} ${dot ? styles.active : ""}`}
            onMouseOver={() => handleMouseOver(index)}
            initial={{ opacity: 0.5 }}
            animate={{ opacity: dot ? 1 : 0.5 }}
            transition={{ duration: 0.3 }}
          />
        ))}
      </div>
      <div className={`${styles.cta} ${revealed ? styles.revealed : ""}`}>
        <p className="text-2xl">Freewheelin by Maxwell Young releases June 7</p>

        <button className={styles["pre-save-button"]}>
          <a href="https://music.drm.co.nz/freewheelin">Pre-Save</a>
        </button>
      </div>
    </div>
  );
};

export default DotMatrix;
